<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Rana9</title>
            
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    
    <!-- Font Awesome untuk ikon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- SheetJS untuk Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Chart.js untuk grafik -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- jsPDF untuk PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- SMTP.js untuk pengiriman email langsung -->
    <script src="https://smtpjs.com/v3/smtp.js"></script>
    
    <style>
        :root {
            --primary-color: #6a11cb;
            --secondary-color: #2575fc;
            --accent-color: #f2994a;
            --text-color: #333;
            --light-bg: #f8f9fa;
            --white: #ffffff;
            --error-color: #e74c3c;
            --success-color: #2ecc71;
            --info-color: #17a2b8;
            --dark-color: #2c3e50;
            --sidebar-width: 250px;
            --mobile-header-height: 60px;
            --warning-color: #f39c12;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--light-bg);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Admin Sidebar */
        .admin-sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: var(--white);
            z-index: 1000;
            overflow-y: auto;
            transition: transform 0.3s ease;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }
        
        .admin-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .admin-header h2 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .admin-header p {
            font-size: 14px;
            opacity: 0.8;
        }
        
        /* Admin Profile Section */
        .admin-profile {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .admin-profile-card {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .admin-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 20px;
            font-weight: 600;
            color: var(--white);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .admin-info h4 {
            font-size: 16px;
            margin-bottom: 3px;
            font-weight: 600;
        }
        
        .admin-info p {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .admin-status {
            display: inline-flex;
            align-items: center;
            font-size: 12px;
            padding: 4px 10px;
            background-color: rgba(46, 204, 113, 0.2);
            border-radius: 20px;
            color: #2ecc71;
        }
        
        .admin-status i {
            width: 8px;
            height: 8px;
            background-color: #2ecc71;
            border-radius: 50%;
            margin-right: 6px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.4);
            }
            70% {
                box-shadow: 0 0 0 6px rgba(46, 204, 113, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(46, 204, 113, 0);
            }
        }
        
        .admin-list-toggle {
            width: 100%;
            padding: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            color: var(--white);
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .admin-list-toggle:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .admin-list {
            margin-top: 10px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .admin-list.show {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .admin-list-item {
            display: flex;
            align-items: center;
            padding: 8px;
            border-radius: 5px;
            margin-bottom: 5px;
            font-size: 13px;
            transition: background-color 0.3s;
        }
        
        .admin-list-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .admin-list-item.active {
            background-color: rgba(255, 255, 255, 0.2);
            font-weight: 500;
        }
        
        .admin-list-item i {
            margin-right: 8px;
            font-size: 12px;
        }
        
        .admin-menu {
            padding: 20px 0;
        }
        
        .admin-menu-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: var(--white);
            text-decoration: none;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .admin-menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .admin-menu-item.active {
            background-color: rgba(255, 255, 255, 0.2);
            border-left: 4px solid var(--accent-color);
        }
        
        .admin-menu-item i {
            margin-right: 15px;
            font-size: 18px;
        }
        
        .admin-logout {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 15px 20px;
            background-color: rgba(0, 0, 0, 0.2);
            text-align: center;
        }
        
        .admin-logout button {
            background: none;
            border: none;
            color: var(--white);
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            margin: 0 auto;
            transition: all 0.3s;
        }
        
        .admin-logout button:hover {
            color: var(--accent-color);
        }
        
        .admin-logout button i {
            margin-right: 10px;
        }
        
        /* Mobile Header */
        .mobile-header {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: var(--mobile-header-height);
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: var(--white);
            z-index: 999;
            align-items: center;
            padding: 0 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .mobile-header-title {
            flex: 1;
            text-align: center;
            font-size: 18px;
            font-weight: 600;
        }
        
        .mobile-admin-info {
            display: flex;
            align-items: center;
            font-size: 12px;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 20px;
        }
        
        .mobile-admin-info i {
            margin-right: 5px;
        }
        
        /* Main Content */
        .admin-main {
            margin-left: var(--sidebar-width);
            padding: 20px;
            flex: 1;
            transition: margin-left 0.3s ease;
        }
        
        .admin-content {
            background-color: var(--white);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .admin-content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .admin-content-header h2 {
            color: var(--primary-color);
            font-size: 24px;
        }
        
        .admin-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            white-space: nowrap;
        }
        
        .btn i {
            margin-right: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: var(--white);
        }
        
        .btn-success {
            background-color: var(--success-color);
            color: var(--white);
        }
        
        .btn-info {
            background-color: var(--info-color);
            color: var(--white);
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            color: var(--white);
        }
        
        .btn-danger {
            background-color: var(--error-color);
            color: var(--white);
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: var(--white);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        /* Search and Filter Styles */
        .search-filter-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .search-box {
            position: relative;
            flex: 1;
            min-width: 250px;
        }
        
        .search-box input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
        }
        
        .search-box i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }
        
        .filter-select {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            background-color: var(--white);
        }
        
        /* Table Styles */
        .table-wrapper {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .data-table th {
            background-color: #4a6fa5;
            color: var(--white);
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .data-table tr:hover {
            background-color: rgba(106, 17, 203, 0.05);
        }
        
        .table-actions {
            display: flex;
            gap: 5px;
        }
        
        .btn-sm {
            padding: 6px 10px;
            font-size: 12px;
        }
        
        /* Statistics Cards */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background-color: var(--white);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 20px;
            display: flex;
            align-items: center;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 24px;
            color: var(--white);
        }
        
        .stat-icon.total {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .stat-icon.sekretaris {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .stat-icon.bendahara {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .stat-icon.pendidikan {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .stat-icon.kewirausahaan {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }
        
        .stat-icon.humas {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }
        
        .stat-icon.perkap {
            background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
        }
        
        .stat-icon.dokumentasi {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }
        
        .stat-icon.publikasi {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
        }
        
        .stat-info h3 {
            font-size: 24px;
            margin-bottom: 5px;
            color: var(--primary-color);
        }
        
        .stat-info p {
            font-size: 14px;
            color: #666;
        }
        
        /* Chart Container */
        .chart-container {
            background-color: var(--white);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
            height: 300px;
        }
        
        /* Download Options */
        .download-options {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .download-options h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
        }
        
        .checkbox-item input {
            margin-right: 8px;
        }
        
        .download-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1003;
            overflow-y: auto;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background-color: var(--white);
            margin: 5% auto;
            padding: 0;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: slideIn 0.3s;
            overflow: hidden;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: var(--white);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--white);
            font-size: 20px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .modal-close:hover {
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .reason-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .reason-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .reason-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .reason-title i {
            margin-right: 10px;
        }
        
        .reason-content {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            line-height: 1.6;
            font-size: 16px;
            color: #555;
            white-space: pre-wrap;
        }
        
        .applicant-info {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .applicant-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 24px;
            font-weight: 600;
            color: var(--white);
        }
        
        .applicant-details h4 {
            font-size: 18px;
            margin-bottom: 5px;
            color: var(--primary-color);
        }
        
        .applicant-details p {
            margin: 3px 0;
            font-size: 14px;
            color: #666;
        }
        
        .applicant-details span {
            font-weight: 500;
            color: var(--text-color);
        }
        
        /* Status Badge */
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-pending {
            background-color: rgba(243, 156, 18, 0.2);
            color: var(--warning-color);
        }
        
        .status-reviewed {
            background-color: rgba(23, 162, 184, 0.2);
            color: var(--info-color);
        }
        
        .status-accepted {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--success-color);
        }
        
        .status-rejected {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--error-color);
        }
        
        /* Bulk Actions */
        .bulk-actions {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }
        
        .bulk-actions.show {
            display: block;
        }
        
        .bulk-actions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .bulk-actions-title {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .bulk-actions-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        /* Notification Settings */
        .notification-settings {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .notification-settings h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .notification-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .notification-form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .notification-form-group label {
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .notification-form-group input,
        .notification-form-group textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Poppins', sans-serif;
            resize: vertical;
        }
        
        .notification-form-group textarea {
            min-height: 100px;
        }
        
        /* Email Settings */
        .email-settings {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .email-settings h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .email-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .email-form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .email-form-group label {
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .email-form-group input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Poppins', sans-serif;
        }
        
        .email-info {
            background-color: #e3f2fd;
            border-left: 4px solid var(--info-color);
            padding: 15px;
            margin-bottom: 15px;
            font-size: 14px;
            color: #0277bd;
            line-height: 1.6;
        }
        
        .email-info a {
            color: #0277bd;
            text-decoration: underline;
        }
        
        .email-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 5px;
        }
        
        .email-status.connected {
            background-color: rgba(46, 204, 113, 0.1);
            color: var(--success-color);
        }
        
        .email-status.disconnected {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--error-color);
        }
        
        .email-status i {
            font-size: 18px;
        }
        
        /* Test Email Section */
        .test-email-section {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .test-email-section h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        /* Activity Log */
        .activity-log {
            background-color: var(--white);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .activity-log h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .activity-item {
            display: flex;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-time {
            min-width: 150px;
            font-size: 12px;
            color: #666;
        }
        
        .activity-content {
            flex: 1;
        }
        
        .activity-user {
            font-weight: 500;
            margin-right: 5px;
        }
        
        .activity-action {
            color: #666;
        }
        
        /* Mobile Menu Toggle */
        .menu-toggle {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1001;
            background-color: rgba(255, 255, 255, 0.2);
            color: var(--white);
            border: none;
            border-radius: 5px;
            padding: 10px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            justify-content: center;
            align-items: center;
        }
        
        /* Loading Spinner */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(106, 17, 203, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: var(--white);
            font-weight: 500;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: translateX(120%);
            transition: transform 0.3s ease-in-out;
            z-index: 1002;
            max-width: 350px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background-color: var(--success-color);
        }
        
        .notification.error {
            background-color: var(--error-color);
        }
        
        .notification.info {
            background-color: var(--info-color);
        }
        
        /* Email Progress Modal */
        .email-progress {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1004;
            justify-content: center;
            align-items: center;
        }
        
        .email-progress.show {
            display: flex;
        }
        
        .email-progress-content {
            background-color: var(--white);
            border-radius: 10px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .email-progress-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 20px;
        }
        
        .email-progress-bar {
            width: 100%;
            height: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .email-progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .email-progress-text {
            font-size: 14px;
            color: #666;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .admin-sidebar {
                transform: translateX(-100%);
                width: 80%;
            }
            
            .admin-sidebar.active {
                transform: translateX(0);
            }
            
            .admin-main {
                margin-left: 0;
                padding-top: calc(var(--mobile-header-height) + 20px);
            }
            
            .mobile-header {
                display: flex;
            }
            
            .menu-toggle {
                display: flex;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .download-options {
                padding: 10px;
            }
            
            .checkbox-group {
                grid-template-columns: 1fr;
            }
            
            .admin-content-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .admin-content-header h2 {
                font-size: 20px;
            }
            
            .data-table th, .data-table td {
                padding: 8px 10px;
                font-size: 14px;
            }
            
            .notification {
                right: 10px;
                left: 10px;
                max-width: none;
            }
            
            .admin-profile {
                padding: 15px;
            }
            
            .admin-avatar {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            
            .admin-info h4 {
                font-size: 14px;
            }
            
            .admin-info p {
                font-size: 11px;
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
            
            .applicant-info {
                flex-direction: column;
                text-align: center;
            }
            
            .applicant-avatar {
                margin-right: 0;
                margin-bottom: 15px;
            }
            
            .search-filter-container {
                flex-direction: column;
                gap: 10px;
            }
            
            .search-box {
                min-width: 100%;
            }
            
            .table-actions {
                flex-direction: column;
                gap: 5px;
            }
            
            .btn-sm {
                padding: 8px 12px;
                font-size: 11px;
            }
            
            .chart-container {
                height: 250px;
            }
            
            .bulk-actions-buttons {
                flex-direction: column;
            }
        }
        
        /* Overlay for mobile sidebar */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 998;
        }
        
        .sidebar-overlay.active {
            display: block;
        }
        
        /* Floating Action Button for Mobile */
        .fab-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 997;
            display: none;
        }
        
        .fab {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--white);
            border: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .fab:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }
        
        .fab i {
            font-size: 24px;
        }
        
        .fab-menu {
            position: absolute;
            bottom: 70px;
            right: 0;
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            opacity: 0;
            transform: scale(0.8) translateY(10px);
            transition: all 0.3s ease;
            width: 200px;
        }
        
        .fab-menu.show {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
        
        .fab-menu-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .fab-menu-item:last-child {
            border-bottom: none;
        }
        
        .fab-menu-item:hover {
            background-color: #f8f9fa;
        }
        
        .fab-menu-item i {
            margin-right: 10px;
            color: var(--primary-color);
        }
    </style>
</head>
<body>
    <!-- Admin Sidebar -->
    <aside class="admin-sidebar" id="adminSidebar">
        <div class="admin-header">
            <h2><i class="fas fa-user-shield"></i> Admin Panel</h2>
            <p>Rana9 Open Recruitment</p>
        </div>
        
        <!-- Admin Profile Section -->
        <div class="admin-profile">
            <div class="admin-profile-card">
                <div class="admin-avatar" id="adminAvatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="admin-info">
                    <h4 id="adminName">Loading...</h4>
                    <p id="adminEmail">Loading...</p>
                </div>
            </div>
            <div class="admin-status">
                <i></i>
                <span>Online</span>
            </div>
            <button class="admin-list-toggle" id="adminListToggle">
                <span>Lihat Admin Lainnya</span>
                <i class="fas fa-chevron-down" id="adminListIcon"></i>
            </button>
            <div class="admin-list" id="adminList">
                <!-- Admin list will be populated here -->
            </div>
        </div>
        
        <nav class="admin-menu">
            <a href="#" class="admin-menu-item active" data-page="all-data">
                <i class="fas fa-database"></i>
                <span>Semua Data</span>
            </a>
            <a href="#" class="admin-menu-item" data-page="division-stats">
                <i class="fas fa-chart-bar"></i>
                <span>Statistik</span>
            </a>
            <a href="#" class="admin-menu-item" data-page="download-data">
                <i class="fas fa-download"></i>
                <span>Download</span>
            </a>
            <a href="#" class="admin-menu-item" data-page="notifications">
                <i class="fas fa-bell"></i>
                <span>Notifikasi</span>
            </a>
            <a href="#" class="admin-menu-item" data-page="email-settings">
                <i class="fas fa-envelope"></i>
                <span>Pengaturan Email</span>
            </a>
            <a href="#" class="admin-menu-item" data-page="activity-log">
                <i class="fas fa-history"></i>
                <span>Aktivitas</span>
            </a>
        </nav>
        
        <div class="admin-logout">
            <button id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </button>
        </div>
    </aside>
    
    <!-- Mobile Header -->
    <header class="mobile-header">
        <button class="menu-toggle" id="menuToggle">
            <i class="fas fa-bars"></i>
        </button>
        <div class="mobile-header-title" id="mobilePageTitle">Semua Data Pendaftar</div>
        <div class="mobile-admin-info">
            <i class="fas fa-user-circle"></i>
            <span id="mobileAdminName">Admin</span>
        </div>
    </header>
    
    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    
    <!-- Main Content -->
    <main class="admin-main">
        <!-- All Data Page -->
        <div class="admin-content" id="allDataPage">
            <div class="admin-content-header">
                <h2>Semua Data Pendaftar</h2>
                <div class="admin-actions">
                    <button class="btn btn-primary" id="refreshDataBtn">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
            
            <!-- Search and Filter Section -->
            <div class="search-filter-container">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Cari berdasarkan nama, NIM, atau email...">
                    <i class="fas fa-search"></i>
                </div>
                <select class="filter-select" id="divisionFilter">
                    <option value="">Semua Divisi</option>
                    <option value="Sekretaris">Sekretaris</option>
                    <option value="Bendahara">Bendahara</option>
                    <option value="Divisi Pendidikan">Divisi Pendidikan</option>
                    <option value="Divisi Kewirausahaan">Divisi Kewirausahaan</option>
                    <option value="Humas (Internal & Eksternal)">Humas</option>
                    <option value="Divisi Perkap">Divisi Perkap</option>
                    <option value="Divisi Dokumentasi">Divisi Dokumentasi</option>
                    <option value="Divisi Publikasi">Divisi Publikasi</option>
                </select>
                <select class="filter-select" id="statusFilter">
                    <option value="">Semua Status</option>
                    <option value="pending">Pending</option>
                    <option value="reviewed">Reviewed</option>
                    <option value="accepted">Accepted</option>
                    <option value="rejected">Rejected</option>
                </select>
            </div>
            
            <!-- Bulk Actions -->
            <div class="bulk-actions" id="bulkActions">
                <div class="bulk-actions-header">
                    <div class="bulk-actions-title">Aksi Massal (<span id="selectedCount">0</span> dipilih)</div>
                    <button class="btn btn-sm btn-secondary" id="clearSelectionBtn">
                        <i class="fas fa-times"></i> Batal Pilih
                    </button>
                </div>
                <div class="bulk-actions-buttons">
                    <button class="btn btn-sm btn-success" id="acceptSelectedBtn">
                        <i class="fas fa-check"></i> Terima
                    </button>
                    <button class="btn btn-sm btn-danger" id="rejectSelectedBtn">
                        <i class="fas fa-times"></i> Tolak
                    </button>
                    <button class="btn btn-sm btn-info" id="notifySelectedBtn">
                        <i class="fas fa-envelope"></i> Kirim Notifikasi
                    </button>
                </div>
            </div>
            
            <div class="loading" id="allDataLoading">
                <div class="spinner"></div>
            </div>
            
            <div class="table-container" id="allDataTableContainer" style="display: none;">
                <div class="table-wrapper">
                    <table class="data-table" id="allDataTable">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="selectAllCheckbox">
                                </th>
                                <th>No</th>
                                <th>Nama</th>
                                <th>NIM</th>
                                <th>Prodi</th>
                                <th>Email</th>
                                <th>No. WhatsApp</th>
                                <th>Divisi Pilihan 1</th>
                                <th>Divisi Pilihan 2</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="allDataTableBody">
                            <!-- Data will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Division Stats Page -->
        <div class="admin-content" id="divisionStatsPage" style="display: none;">
            <div class="admin-content-header">
                <h2>Statistik Pendaftar</h2>
                <div class="admin-actions">
                    <button class="btn btn-primary" id="refreshStatsBtn">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
            
            <div class="loading" id="statsLoading">
                <div class="spinner"></div>
            </div>
            
            <div class="stats-container" id="statsContainer" style="display: none;">
                <!-- Stats cards will be inserted here -->
            </div>
            
            <div class="chart-container" id="chartContainer" style="display: none;">
                <canvas id="divisionChart"></canvas>
            </div>
            
            <div class="table-container" id="statsTableContainer" style="display: none;">
                <div class="table-wrapper">
                    <table class="data-table" id="statsTable">
                        <thead>
                            <tr>
                                <th>Divisi</th>
                                <th>Pilihan Pertama</th>
                                <th>Pilihan Kedua</th>
                                <th>Total Peminat</th>
                            </tr>
                        </thead>
                        <tbody id="statsTableBody">
                            <!-- Data will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Download Data Page -->
        <div class="admin-content" id="downloadDataPage" style="display: none;">
            <div class="admin-content-header">
                <h2>Download Data</h2>
            </div>
            
            <div class="download-options">
                <h3>Pilih Format Download:</h3>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="checkAllData" checked>
                        <label for="checkAllData">Semua Data Pendaftar</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="checkStats" checked>
                        <label for="checkStats">Statistik Per Divisi</label>
                    </div>
                </div>
                
                <div class="download-actions">
                    <button class="btn btn-success" id="downloadExcelBtn">
                        <i class="fas fa-file-excel"></i> Download Excel
                    </button>
                    <button class="btn btn-info" id="downloadPdfBtn">
                        <i class="fas fa-file-pdf"></i> Download PDF
                    </button>
                </div>
            </div>
            
            <div class="admin-content-header" style="margin-top: 30px;">
                <h3>Preview Tabel</h3>
            </div>
            
            <div class="table-container" id="previewTableContainer">
                <!-- Preview table will be inserted here -->
            </div>
        </div>
        
        <!-- Notifications Page -->
        <div class="admin-content" id="notificationsPage" style="display: none;">
            <div class="admin-content-header">
                <h2>Pengaturan Notifikasi</h2>
            </div>
            
            <div class="notification-settings">
                <h3>Kirim Notifikasi Massal</h3>
                <div class="notification-form">
                    <div class="notification-form-group">
                        <label>Pilih Penerima:</label>
                        <select class="filter-select" id="notificationRecipients">
                            <option value="all">Semua Pendaftar</option>
                            <option value="pending">Pendaftar dengan Status Pending</option>
                            <option value="accepted">Pendaftar dengan Status Accepted</option>
                            <option value="rejected">Pendaftar dengan Status Rejected</option>
                        </select>
                    </div>
                    <div class="notification-form-group">
                        <label>Subject Email:</label>
                        <input type="text" id="emailSubject" placeholder="Masukkan subject email...">
                    </div>
                    <div class="notification-form-group">
                        <label>Pesan:</label>
                        <textarea id="notificationMessage" placeholder="Masukkan pesan notifikasi..."></textarea>
                    </div>
                    <div class="notification-form-group">
                        <label>Template Email:</label>
                        <select class="filter-select" id="emailTemplate">
                            <option value="general">Umum</option>
                            <option value="accepted">Penerimaan</option>
                            <option value="rejected">Penolakan</option>
                            <option value="interview">Undangan Wawancara</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" id="sendNotificationBtn">
                        <i class="fas fa-paper-plane"></i> Kirim Notifikasi
                    </button>
                </div>
            </div>
            
            <div class="activity-log">
                <h3>Riwayat Notifikasi Terkirim</h3>
                <div id="notificationLog">
                    <!-- Notification log will be inserted here -->
                </div>
            </div>
        </div>
        
        <!-- Email Settings Page -->
        <div class="admin-content" id="emailSettingsPage" style="display: none;">
            <div class="admin-content-header">
                <h2>Pengaturan Email</h2>
            </div>
            
            <div class="email-settings">
                <h3>Konfigurasi Email SMTP</h3>
                <div class="email-info">
                    <i class="fas fa-info-circle"></i> 
                    <strong>Panduan Setup Email Gmail:</strong><br>
                    1. Aktifkan 2-Step Verification di akun Google Anda<br>
                    2. Buka <a href="https://myaccount.google.com/apppasswords" target="_blank">Google App Passwords</a><br>
                    3. Pilih "Mail" pada "Select app"<br>
                    4. Pilih "Other (Custom name)" dan beri nama "Rana9 Admin"<br>
                    5. Copy password yang muncul (16 karakter)<br>
                    6. Masukkan email dan App Password di form di bawah
                </div>
                
                <div class="email-status" id="emailStatus">
                    <i class="fas fa-circle"></i>
                    <span id="emailStatusText">Memeriksa status...</span>
                </div>
                
                <div class="email-form">
                    <div class="email-form-group">
                        <label>Email Pengirim:</label>
                        <input type="email" id="senderEmail" placeholder="ukmrana9@harkatnegeri.ac.id">
                    </div>
                    <div class="email-form-group">
                        <label>App Password (16 karakter):</label>
                        <input type="password" id="appPassword" placeholder="Masukkan App Password dari Google">
                    </div>
                    <div class="email-form-group">
                        <label>Nama Pengirim:</label>
                        <input type="text" id="senderName" placeholder="Admin Rana9">
                    </div>
                    <div class="email-form-group">
                        <label>SMTP Server:</label>
                        <input type="text" id="smtpServer" value="smtp.gmail.com" readonly>
                    </div>
                    <div class="email-form-group">
                        <label>SMTP Port:</label>
                        <input type="number" id="smtpPort" value="587" readonly>
                    </div>
                    <button class="btn btn-primary" id="saveEmailSettingsBtn">
                        <i class="fas fa-save"></i> Simpan Pengaturan
                    </button>
                    <button class="btn btn-secondary" id="testEmailBtn">
                        <i class="fas fa-paper-plane"></i> Test Kirim Email
                    </button>
                </div>
            </div>
            
            <div class="test-email-section">
                <h3>Test Email</h3>
                <div class="email-form">
                    <div class="email-form-group">
                        <label>Email Tujuan Test:</label>
                        <input type="email" id="testEmailRecipient" placeholder="Masukkan email tujuan test">
                    </div>
                    <div class="email-form-group">
                        <label>Subject Test:</label>
                        <input type="text" id="testEmailSubject" placeholder="Test Email dari Rana9">
                    </div>
                    <div class="email-form-group">
                        <label>Pesan Test:</label>
                        <textarea id="testEmailMessage" placeholder="Ini adalah email test untuk memverifikasi konfigurasi SMTP.">Ini adalah email test untuk memverifikasi konfigurasi SMTP.</textarea>
                    </div>
                    <button class="btn btn-info" id="sendTestEmailBtn">
                        <i class="fas fa-paper-plane"></i> Kirim Email Test
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Activity Log Page -->
        <div class="admin-content" id="activityLogPage" style="display: none;">
            <div class="admin-content-header">
                <h2>Log Aktivitas Admin</h2>
                <div class="admin-actions">
                    <button class="btn btn-primary" id="refreshLogBtn">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
            
            <div class="loading" id="logLoading">
                <div class="spinner"></div>
            </div>
            
            <div class="activity-log" id="activityLogContainer" style="display: none;">
                <!-- Activity log will be inserted here -->
            </div>
        </div>
    </main>
    
    <!-- Floating Action Button for Mobile -->
    <div class="fab-container" id="fabContainer">
        <button class="fab" id="fabBtn">
            <i class="fas fa-plus"></i>
        </button>
        <div class="fab-menu" id="fabMenu">
            <div class="fab-menu-item" id="fabRefresh">
                <i class="fas fa-sync-alt"></i> Refresh Data
            </div>
            <div class="fab-menu-item" id="fabFilter">
                <i class="fas fa-filter"></i> Filter
            </div>
            <div class="fab-menu-item" id="fabDownload">
                <i class="fas fa-download"></i> Download
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification"></div>
    
    <!-- Email Progress Modal -->
    <div class="email-progress" id="emailProgress">
        <div class="email-progress-content">
            <div class="email-progress-title">Mengirim Email...</div>
            <div class="email-progress-bar">
                <div class="email-progress-fill" id="emailProgressFill"></div>
            </div>
            <div class="email-progress-text" id="emailProgressText">Memproses 0 dari 0 email</div>
        </div>
    </div>
    
    <!-- Modal for Viewing Applicant Details -->
    <div class="modal" id="applicantModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Detail Pendaftar</h3>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="applicant-info">
                    <div class="applicant-avatar" id="modalAvatar">
                        <!-- Initial will be inserted here -->
                    </div>
                    <div class="applicant-details">
                        <h4 id="modalName">Nama</h4>
                        <p>NIM: <span id="modalNIM">-</span></p>
                        <p>Prodi: <span id="modalProdi">-</span></p>
                        <p>Email: <span id="modalEmail">-</span></p>
                        <p>No. WhatsApp: <span id="modalWhatsApp">-</span></p>
                        <p>Divisi Pilihan 1: <span id="modalDivisi1">-</span></p>
                        <p>Divisi Pilihan 2: <span id="modalDivisi2">-</span></p>
                        <p>Status: <span id="modalStatus" class="status-badge">-</span></p>
                    </div>
                </div>
                
                <div class="reason-section">
                    <div class="reason-title">
                        <i class="fas fa-question-circle"></i>
                        Alasan Ikut Open Recruitment Rana
                    </div>
                    <div class="reason-content" id="modalAlasan">
                        <!-- Alasan will be inserted here -->
                    </div>
                </div>
                
                <div class="reason-section">
                    <div class="reason-title">
                        <i class="fas fa-star"></i>
                        Alasan Memilih Divisi Pertama
                    </div>
                    <div class="reason-content" id="modalAlasanDivisi1">
                        <!-- Alasan will be inserted here -->
                    </div>
                </div>
                
                <div class="reason-section">
                    <div class="reason-title">
                        <i class="fas fa-star-half-alt"></i>
                        Alasan Memilih Divisi Kedua
                    </div>
                    <div class="reason-content" id="modalAlasanDivisi2">
                        <!-- Alasan will be inserted here -->
                    </div>
                </div>
                
                <div class="admin-actions" style="margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
                    <button class="btn btn-success" id="acceptBtn">
                        <i class="fas fa-check"></i> Terima
                    </button>
                    <button class="btn btn-danger" id="rejectBtn">
                        <i class="fas fa-times"></i> Tolak
                    </button>
                    <button class="btn btn-info" id="sendEmailBtn">
                        <i class="fas fa-envelope"></i> Kirim Email
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyC2yQsDR6J3dzkdTJAZDtA6BKTiKvqqhSI",
            authDomain: "myapp-c1981.firebaseapp.com",
            databaseURL: "https://myapp-c1981-default-rtdb.firebaseio.com",
            projectId: "myapp-c1981",
            storageBucket: "myapp-c1981.firebasestorage.app",
            messagingSenderId: "721330953305",
            appId: "1:721330953305:web:26d329ff6ad1611918a548",
            measurementId: "G-7BW3KJLJ66"
        };
        
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();
        
        // Email Configuration
        let emailConfig = {
            email: '',
            appPassword: '',
            name: 'Admin Rana9',
            smtpServer: 'smtp.gmail.com',
            smtpPort: 587
        };
        
        // DOM Elements
        const menuToggle = document.getElementById('menuToggle');
        const adminSidebar = document.getElementById('adminSidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const logoutBtn = document.getElementById('logoutBtn');
        const notification = document.getElementById('notification');
        const mobilePageTitle = document.getElementById('mobilePageTitle');
        
        // Admin Profile Elements
        const adminAvatar = document.getElementById('adminAvatar');
        const adminName = document.getElementById('adminName');
        const adminEmail = document.getElementById('adminEmail');
        const mobileAdminName = document.getElementById('mobileAdminName');
        const adminListToggle = document.getElementById('adminListToggle');
        const adminListIcon = document.getElementById('adminListIcon');
        const adminList = document.getElementById('adminList');
        
        // Page Elements
        const allDataPage = document.getElementById('allDataPage');
        const divisionStatsPage = document.getElementById('divisionStatsPage');
        const downloadDataPage = document.getElementById('downloadDataPage');
        const notificationsPage = document.getElementById('notificationsPage');
        const emailSettingsPage = document.getElementById('emailSettingsPage');
        const activityLogPage = document.getElementById('activityLogPage');
        
        // Data Elements
        const allDataLoading = document.getElementById('allDataLoading');
        const allDataTableContainer = document.getElementById('allDataTableContainer');
        const allDataTableBody = document.getElementById('allDataTableBody');
        const refreshDataBtn = document.getElementById('refreshDataBtn');
        const searchInput = document.getElementById('searchInput');
        const divisionFilter = document.getElementById('divisionFilter');
        const statusFilter = document.getElementById('statusFilter');
        const selectAllCheckbox = document.getElementById('selectAllCheckbox');
        const bulkActions = document.getElementById('bulkActions');
        const selectedCount = document.getElementById('selectedCount');
        const clearSelectionBtn = document.getElementById('clearSelectionBtn');
        const acceptSelectedBtn = document.getElementById('acceptSelectedBtn');
        const rejectSelectedBtn = document.getElementById('rejectSelectedBtn');
        const notifySelectedBtn = document.getElementById('notifySelectedBtn');
        
        // Stats Elements
        const statsLoading = document.getElementById('statsLoading');
        const statsContainer = document.getElementById('statsContainer');
        const chartContainer = document.getElementById('chartContainer');
        const statsTableContainer = document.getElementById('statsTableContainer');
        const statsTableBody = document.getElementById('statsTableBody');
        const refreshStatsBtn = document.getElementById('refreshStatsBtn');
        
        // Download Elements
        const checkAllData = document.getElementById('checkAllData');
        const checkStats = document.getElementById('checkStats');
        const downloadExcelBtn = document.getElementById('downloadExcelBtn');
        const downloadPdfBtn = document.getElementById('downloadPdfBtn');
        const previewTableContainer = document.getElementById('previewTableContainer');
        
        // Notification Elements
        const sendNotificationBtn = document.getElementById('sendNotificationBtn');
        const notificationRecipients = document.getElementById('notificationRecipients');
        const notificationMessage = document.getElementById('notificationMessage');
        const emailSubject = document.getElementById('emailSubject');
        const notificationLog = document.getElementById('notificationLog');
        const emailTemplate = document.getElementById('emailTemplate');
        
        // Email Settings Elements
        const emailStatus = document.getElementById('emailStatus');
        const emailStatusText = document.getElementById('emailStatusText');
        const senderEmail = document.getElementById('senderEmail');
        const appPassword = document.getElementById('appPassword');
        const senderName = document.getElementById('senderName');
        const smtpServer = document.getElementById('smtpServer');
        const smtpPort = document.getElementById('smtpPort');
        const saveEmailSettingsBtn = document.getElementById('saveEmailSettingsBtn');
        const testEmailBtn = document.getElementById('testEmailBtn');
        const testEmailRecipient = document.getElementById('testEmailRecipient');
        const testEmailSubject = document.getElementById('testEmailSubject');
        const testEmailMessage = document.getElementById('testEmailMessage');
        const sendTestEmailBtn = document.getElementById('sendTestEmailBtn');
        
        // Activity Log Elements
        const logLoading = document.getElementById('logLoading');
        const activityLogContainer = document.getElementById('activityLogContainer');
        const refreshLogBtn = document.getElementById('refreshLogBtn');
        
        // Modal Elements
        const applicantModal = document.getElementById('applicantModal');
        const closeModal = document.getElementById('closeModal');
        const modalAvatar = document.getElementById('modalAvatar');
        const modalName = document.getElementById('modalName');
        const modalNIM = document.getElementById('modalNIM');
        const modalProdi = document.getElementById('modalProdi');
        const modalEmail = document.getElementById('modalEmail');
        const modalWhatsApp = document.getElementById('modalWhatsApp');
        const modalDivisi1 = document.getElementById('modalDivisi1');
        const modalDivisi2 = document.getElementById('modalDivisi2');
        const modalStatus = document.getElementById('modalStatus');
        const modalAlasan = document.getElementById('modalAlasan');
        const modalAlasanDivisi1 = document.getElementById('modalAlasanDivisi1');
        const modalAlasanDivisi2 = document.getElementById('modalAlasanDivisi2');
        const acceptBtn = document.getElementById('acceptBtn');
        const rejectBtn = document.getElementById('rejectBtn');
        const sendEmailBtn = document.getElementById('sendEmailBtn');
        
        // Email Progress Elements
        const emailProgress = document.getElementById('emailProgress');
        const emailProgressFill = document.getElementById('emailProgressFill');
        const emailProgressText = document.getElementById('emailProgressText');
        
        // FAB Elements
        const fabContainer = document.getElementById('fabContainer');
        const fabBtn = document.getElementById('fabBtn');
        const fabMenu = document.getElementById('fabMenu');
        const fabRefresh = document.getElementById('fabRefresh');
        const fabFilter = document.getElementById('fabFilter');
        const fabDownload = document.getElementById('fabDownload');
        
        // Global Variables
        let allRegistrations = [];
        let filteredRegistrations = [];
        let divisionStats = {};
        let totalRegistrants = 0;
        let currentUser = null;
        let selectedRegistrations = [];
        let divisionChart = null;
        
        // Admin List (hardcoded for demo, can be fetched from Firebase)
        const adminUsers = [
            { email: 'sync@hsn.com', name: 'Server', role: 'Server Data' },
            { email: 'husain@gmail.com', name: 'Husain', role: 'Super Admin' },
            { email: 'alma@hsn.com', name: 'Alma', role: 'Admin' },
            { email: 'alvin@hsn.com', name: 'Alvin', role: 'Admin' },
        ];
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            auth.onAuthStateChanged(function(user) {
                if (!user) {
                    // Redirect to login page if not logged in
                    window.location.href = 'login.html';
                } else {
                    currentUser = user;
                    // Update admin profile
                    updateAdminProfile(user);
                    // Load admin list
                    loadAdminList();
                    // Load email settings
                    loadEmailSettings();
                    // Load initial data
                    loadAllData();
                    loadDivisionStats();
                    loadActivityLog();
                }
            });
            
            // Menu Toggle
            menuToggle.addEventListener('click', function() {
                adminSidebar.classList.toggle('active');
                sidebarOverlay.classList.toggle('active');
            });
            
            // Sidebar Overlay Click
            sidebarOverlay.addEventListener('click', function() {
                adminSidebar.classList.remove('active');
                sidebarOverlay.classList.remove('active');
            });
            
            // Admin List Toggle
            adminListToggle.addEventListener('click', function() {
                adminList.classList.toggle('show');
                const icon = adminListIcon;
                if (adminList.classList.contains('show')) {
                    icon.classList.remove('fa-chevron-down');
                    icon.classList.add('fa-chevron-up');
                } else {
                    icon.classList.remove('fa-chevron-up');
                    icon.classList.add('fa-chevron-down');
                }
            });
            
            // Logout
            logoutBtn.addEventListener('click', function() {
                auth.signOut().then(function() {
                    showNotification('Anda telah berhasil logout', 'success');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 1000);
                }).catch(function(error) {
                    showNotification('Error: ' + error.message, 'error');
                });
            });
            
            // Navigation Menu
            document.querySelectorAll('.admin-menu-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove active class from all items
                    document.querySelectorAll('.admin-menu-item').forEach(i => {
                        i.classList.remove('active');
                    });
                    
                    // Add active class to clicked item
                    this.classList.add('active');
                    
                    // Hide all pages
                    allDataPage.style.display = 'none';
                    divisionStatsPage.style.display = 'none';
                    downloadDataPage.style.display = 'none';
                    notificationsPage.style.display = 'none';
                    emailSettingsPage.style.display = 'none';
                    activityLogPage.style.display = 'none';
                    
                    // Show selected page
                    const page = this.getAttribute('data-page');
                    if (page === 'all-data') {
                        allDataPage.style.display = 'block';
                        mobilePageTitle.textContent = 'Semua Data Pendaftar';
                    } else if (page === 'division-stats') {
                        divisionStatsPage.style.display = 'block';
                        mobilePageTitle.textContent = 'Statistik';
                    } else if (page === 'download-data') {
                        downloadDataPage.style.display = 'block';
                        mobilePageTitle.textContent = 'Download';
                        updatePreviewTable();
                    } else if (page === 'notifications') {
                        notificationsPage.style.display = 'block';
                        mobilePageTitle.textContent = 'Notifikasi';
                    } else if (page === 'email-settings') {
                        emailSettingsPage.style.display = 'block';
                        mobilePageTitle.textContent = 'Pengaturan Email';
                    } else if (page === 'activity-log') {
                        activityLogPage.style.display = 'block';
                        mobilePageTitle.textContent = 'Aktivitas';
                    }
                    
                    // Close sidebar on mobile
                    if (window.innerWidth <= 768) {
                        adminSidebar.classList.remove('active');
                        sidebarOverlay.classList.remove('active');
                    }
                });
            });
            
            // Refresh Data Button
            refreshDataBtn.addEventListener('click', function() {
                loadAllData();
            });
            
            // Search Input
            searchInput.addEventListener('input', function() {
                filterData();
            });
            
            // Division Filter
            divisionFilter.addEventListener('change', function() {
                filterData();
            });
            
            // Status Filter
            statusFilter.addEventListener('change', function() {
                filterData();
            });
            
            // Select All Checkbox
            selectAllCheckbox.addEventListener('change', function() {
                const isChecked = this.checked;
                document.querySelectorAll('.applicant-checkbox').forEach(checkbox => {
                    checkbox.checked = isChecked;
                });
                updateSelectedCount();
            });
            
            // Clear Selection Button
            clearSelectionBtn.addEventListener('click', function() {
                document.querySelectorAll('.applicant-checkbox').forEach(checkbox => {
                    checkbox.checked = false;
                });
                selectAllCheckbox.checked = false;
                updateSelectedCount();
                bulkActions.classList.remove('show');
            });
            
            // Accept Selected Button
            acceptSelectedBtn.addEventListener('click', function() {
                updateSelectedStatus('accepted');
            });
            
            // Reject Selected Button
            rejectSelectedBtn.addEventListener('click', function() {
                updateSelectedStatus('rejected');
            });
            
            // Notify Selected Button
            notifySelectedBtn.addEventListener('click', function() {
                notifySelectedApplicants();
            });
            
            // Refresh Stats Button
            refreshStatsBtn.addEventListener('click', function() {
                loadDivisionStats();
            });
            
            // Download Buttons
            downloadExcelBtn.addEventListener('click', function() {
                downloadExcel();
            });
            
            downloadPdfBtn.addEventListener('click', function() {
                downloadPDF();
            });
            
            // Update preview when checkboxes change
            checkAllData.addEventListener('change', updatePreviewTable);
            checkStats.addEventListener('change', updatePreviewTable);
            
            // Send Notification Button
            sendNotificationBtn.addEventListener('click', function() {
                sendBulkNotification();
            });
            
            // Email Template Change
            emailTemplate.addEventListener('change', function() {
                const template = this.value;
                
                if (template === 'accepted') {
                    emailSubject.value = 'Selamat! Anda Diterima di Rana9 Open Recruitment';
                    notificationMessage.value = 'Selamat! Kami dengan senang hati menginformasikan bahwa Anda telah diterima dalam proses rekrutmen UKM Rana9. Silakan persiapkan diri untuk tahap selanjutnya.';
                } else if (template === 'rejected') {
                    emailSubject.value = 'Informasi Hasil Seleksi Rana9 Open Recruitment';
                    notificationMessage.value = 'Terima kasih atas partisipasi Anda dalam proses rekrutmen UKM Rana9. Setelah melalui proses seleksi, kami mohon maaf karena saat ini Anda belum dapat kami terima. Jangan menyerah dan terus kembangkan potensi Anda!';
                } else if (template === 'interview') {
                    emailSubject.value = 'Undangan Wawancara Rana9 Open Recruitment';
                    notificationMessage.value = 'Selamat! Anda telah lolos ke tahap wawancara dalam proses rekrutmen UKM Rana9. Silakan hadir pada waktu dan tempat yang telah ditentukan untuk mengikuti sesi wawancara.';
                }
            });
            
            // Email Settings Buttons
            saveEmailSettingsBtn.addEventListener('click', function() {
                saveEmailSettings();
            });
            
            testEmailBtn.addEventListener('click', function() {
                // Scroll to test email section
                document.querySelector('.test-email-section').scrollIntoView({ behavior: 'smooth' });
            });
            
            sendTestEmailBtn.addEventListener('click', function() {
                sendTestEmail();
            });
            
            // Refresh Log Button
            refreshLogBtn.addEventListener('click', function() {
                loadActivityLog();
            });
            
            // Modal Close Button
            closeModal.addEventListener('click', function() {
                applicantModal.style.display = 'none';
            });
            
            // Accept Button in Modal
            acceptBtn.addEventListener('click', function() {
                const registrationId = this.getAttribute('data-id');
                updateStatus(registrationId, 'accepted');
            });
            
            // Reject Button in Modal
            rejectBtn.addEventListener('click', function() {
                const registrationId = this.getAttribute('data-id');
                updateStatus(registrationId, 'rejected');
            });
            
            // Send Email Button in Modal
            sendEmailBtn.addEventListener('click', function() {
                const registrationId = this.getAttribute('data-id');
                sendEmailToApplicant(registrationId);
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(e) {
                if (e.target === applicantModal) {
                    applicantModal.style.display = 'none';
                }
            });
            
            // FAB Button
            fabBtn.addEventListener('click', function() {
                fabMenu.classList.toggle('show');
            });
            
            // FAB Menu Items
            fabRefresh.addEventListener('click', function() {
                loadAllData();
                fabMenu.classList.remove('show');
            });
            
            fabFilter.addEventListener('click', function() {
                // Focus on search input
                searchInput.focus();
                fabMenu.classList.remove('show');
            });
            
            fabDownload.addEventListener('click', function() {
                // Navigate to download page
                document.querySelector('[data-page="download-data"]').click();
                fabMenu.classList.remove('show');
            });
        });
        
        // Load Email Settings
        function loadEmailSettings() {
            database.ref('emailSettings').once('value')
                .then(snapshot => {
                    const settings = snapshot.val();
                    if (settings) {
                        senderEmail.value = settings.email || '';
                        appPassword.value = settings.appPassword || '';
                        senderName.value = settings.name || 'Admin Rana9';
                        smtpServer.value = settings.smtpServer || 'smtp.gmail.com';
                        smtpPort.value = settings.smtpPort || '587';
                        
                        // Update email config
                        emailConfig.email = settings.email || '';
                        emailConfig.appPassword = settings.appPassword || '';
                        emailConfig.name = settings.name || 'Admin Rana9';
                        emailConfig.smtpServer = settings.smtpServer || 'smtp.gmail.com';
                        emailConfig.smtpPort = settings.smtpPort || '587';
                        
                        // Update email status
                        if (emailConfig.email && emailConfig.appPassword) {
                            updateEmailStatus(true);
                        } else {
                            updateEmailStatus(false);
                        }
                    } else {
                        // Set default values
                        senderEmail.value = '';
                        appPassword.value = '';
                        senderName.value = 'Admin Rana9';
                        smtpServer.value = 'smtp.gmail.com';
                        smtpPort.value = '587';
                        
                        updateEmailStatus(false);
                    }
                })
                .catch(error => {
                    console.error('Error loading email settings:', error);
                    updateEmailStatus(false);
                });
        }
        
        // Save Email Settings
        function saveEmailSettings() {
            const email = senderEmail.value.trim();
            const password = appPassword.value.trim();
            const name = senderName.value.trim();
            const server = smtpServer.value.trim();
            const port = smtpPort.value.trim();
            
            if (!email || !password || !name || !server || !port) {
                showNotification('Semua field harus diisi', 'error');
                return;
            }
            
            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showNotification('Format email tidak valid', 'error');
                return;
            }
            
            // Validate app password (should be 16 characters for Gmail)
            if (password.length !== 16) {
                showNotification('App Password harus 16 karakter', 'error');
                return;
            }
            
            // Save to Firebase
            database.ref('emailSettings').set({
                email: email,
                appPassword: password,
                name: name,
                smtpServer: server,
                smtpPort: port
            })
            .then(() => {
                // Update email config
                emailConfig.email = email;
                emailConfig.appPassword = password;
                emailConfig.name = name;
                emailConfig.smtpServer = server;
                emailConfig.smtpPort = port;
                
                showNotification('Pengaturan email berhasil disimpan', 'success');
                updateEmailStatus(true);
                
                // Log activity
                logActivity(currentUser.email, 'Updated email settings');
            })
            .catch(error => {
                showNotification('Error saving email settings: ' + error.message, 'error');
            });
        }
        
        // Update Email Status
        function updateEmailStatus(isConnected) {
            if (isConnected) {
                emailStatus.className = 'email-status connected';
                emailStatus.innerHTML = `
                    <i class="fas fa-check-circle"></i>
                    <span>Email terkonfigurasi dengan benar</span>
                `;
            } else {
                emailStatus.className = 'email-status disconnected';
                emailStatus.innerHTML = `
                    <i class="fas fa-exclamation-circle"></i>
                    <span>Email belum dikonfigurasi</span>
                `;
            }
        }
        
        // Send Test Email
        function sendTestEmail() {
            const recipient = testEmailRecipient.value.trim();
            const subject = testEmailSubject.value.trim();
            const message = testEmailMessage.value.trim();
            
            if (!recipient || !subject || !message) {
                showNotification('Semua field test email harus diisi', 'error');
                return;
            }
            
            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(recipient)) {
                showNotification('Format email tujuan tidak valid', 'error');
                return;
            }
            
            // Check if email is configured
            if (!emailConfig.email || !emailConfig.appPassword) {
                showNotification('Email belum dikonfigurasi. Silakan atur terlebih dahulu.', 'error');
                return;
            }
            
            // Show progress
            emailProgress.classList.add('show');
            emailProgressFill.style.width = '50%';
            emailProgressText.textContent = 'Mengirim email test...';
            
            // Send email using SMTP.js
            Email.send({
                Host: emailConfig.smtpServer,
                Port: emailConfig.smtpPort,
                Username: emailConfig.email,
                Password: emailConfig.appPassword,
                To: recipient,
                From: emailConfig.email,
                Subject: subject,
                Body: message
            })
            .then(function(message) {
                emailProgressFill.style.width = '100%';
                emailProgressText.textContent = 'Email test berhasil dikirim!';
                
                setTimeout(() => {
                    emailProgress.classList.remove('show');
                    showNotification('Email test berhasil dikirim ke ' + recipient, 'success');
                    
                    // Log activity
                    logActivity(currentUser.email, `Sent test email to ${recipient}`);
                }, 1000);
            })
            .catch(function(error) {
                console.error('Failed to send test email:', error);
                
                emailProgress.classList.remove('show');
                showNotification('Gagal mengirim email test: ' + error, 'error');
            });
        }
        
        // Update Admin Profile
        function updateAdminProfile(user) {
            // Get admin info from the list
            const adminInfo = adminUsers.find(admin => admin.email === user.email) || {
                name: user.email.split('@')[0],
                email: user.email,
                role: 'Admin'
            };
            
            // Update sidebar
            adminName.textContent = adminInfo.name;
            adminEmail.textContent = adminInfo.email;
            
            // Update mobile header
            mobileAdminName.textContent = adminInfo.name;
            
            // Update avatar with initial
            const initial = adminInfo.name.charAt(0).toUpperCase();
            adminAvatar.innerHTML = initial;
            adminAvatar.style.background = `linear-gradient(135deg, ${getRandomColor()}, ${getRandomColor()})`;
        }
        
        // Load Admin List
        function loadAdminList() {
            adminList.innerHTML = '';
            
            adminUsers.forEach(admin => {
                const adminItem = document.createElement('div');
                adminItem.className = 'admin-list-item';
                
                // Check if this is the current user
                if (currentUser && admin.email === currentUser.email) {
                    adminItem.classList.add('active');
                }

                // Determine icon based on role
                let icon = 'fa-user';

                if (admin.role === 'Super Admin') {
                    icon = 'fa-user-shield';
                } else if (admin.role === 'Admin') {
                    icon = 'fa-user-check';
                } else if (admin.role === 'Admin Server' || admin.role === 'Server Data') {
                    icon = 'fa-server';
                }

                adminItem.innerHTML = `
                    <i class="fas ${icon}"></i>
                    <div>
                        <div style="font-weight: 500;">${admin.name}</div>
                        <div style="font-size: 11px; opacity: 0.7;">${admin.role}</div>
                    </div>
                `;
                
                adminList.appendChild(adminItem);
            });
        }
        
        // Get Random Color for Avatar
        function getRandomColor() {
            const colors = [
                '#667eea', '#764ba2', '#f093fb', '#f5576c',
                '#4facfe', '#00f2fe', '#43e97b', '#38f9d7',
                '#fa709a', '#fee140', '#30cfd0', '#330867'
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        // Filter Data based on search and filters
        function filterData() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            const divisionFilterValue = divisionFilter.value;
            const statusFilterValue = statusFilter.value;
            
            filteredRegistrations = allRegistrations.filter(registration => {
                const matchesSearch = !searchTerm || 
                    registration.nama.toLowerCase().includes(searchTerm) ||
                    registration.nim.toLowerCase().includes(searchTerm) ||
                    registration.email.toLowerCase().includes(searchTerm);
                    
                const matchesDivision = !divisionFilterValue || registration.firstDivision === divisionFilterValue || registration.secondDivision === divisionFilterValue;
                
                const matchesStatus = !statusFilterValue || registration.status === statusFilterValue;
                
                return matchesSearch && matchesDivision && matchesStatus;
            });
            
            populateAllDataTable();
        }
        
        // Load All Data
        function loadAllData() {
            allDataLoading.style.display = 'flex';
            allDataTableContainer.style.display = 'none';
            
            database.ref('registrations').once('value')
                .then(snapshot => {
                    allRegistrations = [];
                    const data = snapshot.val();
                    
                    if (data) {
                        Object.keys(data).forEach(key => {
                            const registration = data[key];
                            registration.id = key;
                            // Add status if not exists
                            if (!registration.status) {
                                registration.status = 'pending';
                            }
                            allRegistrations.push(registration);
                        });
                        
                        // Update total registrants
                        totalRegistrants = allRegistrations.length;
                        
                        // Sort by timestamp
                        allRegistrations.sort((a, b) => {
                            return new Date(b.timestamp) - new Date(a.timestamp);
                        });
                        
                        // Filter and populate table
                        filterData();
                    }
                    
                    allDataLoading.style.display = 'none';
                    allDataTableContainer.style.display = 'block';
                })
                .catch(error => {
                    showNotification('Error loading data: ' + error.message, 'error');
                    allDataLoading.style.display = 'none';
                });
        }
        
        // Populate All Data Table
        function populateAllDataTable() {
            allDataTableBody.innerHTML = '';
            
            if (filteredRegistrations.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="11" style="text-align: center; padding: 20px;">Tidak ada data yang sesuai dengan filter</td>
                `;
                allDataTableBody.appendChild(row);
                return;
            }
            
            filteredRegistrations.forEach((registration, index) => {
                const row = document.createElement('tr');
                
                // Format timestamp
                const timestamp = new Date(registration.timestamp);
                const formattedTimestamp = timestamp.toLocaleString('id-ID');
                
                // Get status badge class
                let statusClass = 'status-badge';
                if (registration.status === 'pending') {
                    statusClass += ' status-pending';
                } else if (registration.status === 'reviewed') {
                    statusClass += ' status-reviewed';
                } else if (registration.status === 'accepted') {
                    statusClass += ' status-accepted';
                } else if (registration.status === 'rejected') {
                    statusClass += ' status-rejected';
                }
                
                row.innerHTML = `
                    <td>
                        <input type="checkbox" class="applicant-checkbox" data-id="${registration.id}">
                    </td>
                    <td>${index + 1}</td>
                    <td>${registration.nama}</td>
                    <td>${registration.nim}</td>
                    <td>${registration.prodi}</td>
                    <td>${registration.email}</td>
                    <td>${registration.noWa}</td>
                    <td>${registration.firstDivision}</td>
                    <td>${registration.secondDivision}</td>
                    <td><span class="${statusClass}">${registration.status}</span></td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-secondary btn-sm view-details" data-id="${registration.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                allDataTableBody.appendChild(row);
            });
            
            // Add event listeners to view buttons
            document.querySelectorAll('.view-details').forEach(button => {
                button.addEventListener('click', function() {
                    const registrationId = this.getAttribute('data-id');
                    showApplicantDetails(registrationId);
                });
            });
            
            // Add event listeners to checkboxes
            document.querySelectorAll('.applicant-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    updateSelectedCount();
                });
            });
        }
        
        // Update Selected Count
        function updateSelectedCount() {
            const checkedBoxes = document.querySelectorAll('.applicant-checkbox:checked');
            selectedCount.textContent = checkedBoxes.length;
            
            if (checkedBoxes.length > 0) {
                bulkActions.classList.add('show');
            } else {
                bulkActions.classList.remove('show');
            }
        }
        
        // Update Selected Status
        function updateSelectedStatus(status) {
            const selectedIds = Array.from(document.querySelectorAll('.applicant-checkbox:checked'))
                .map(checkbox => checkbox.getAttribute('data-id'));
            
            if (selectedIds.length === 0) {
                showNotification('Pilih setidak ada pendaftar', 'error');
                return;
            }
            
            // Update status in Firebase
            const updates = {};
            selectedIds.forEach(id => {
                updates[id] = { status: status };
            });
            
            database.ref('registrations').update(updates)
                .then(() => {
                    // Update local data
                    selectedIds.forEach(id => {
                        const registration = allRegistrations.find(reg => reg.id === id);
                        if (registration) {
                            registration.status = status;
                        }
                    });
                    
                    // Refresh table
                    filterData();
                    
                    // Log activity
                    logActivity(currentUser.email, `Updated status to ${status} for ${selectedIds.length} applicants`);
                    
                    // Clear selection
                    document.querySelectorAll('.applicant-checkbox').forEach(checkbox => {
                        checkbox.checked = false;
                    });
                    selectAllCheckbox.checked = false;
                    updateSelectedCount();
                    
                    showNotification(`Status berhasil diperbarui menjadi ${status} untuk ${selectedIds.length} pendaftar`, 'success');
                })
                .catch(error => {
                    showNotification('Error updating status: ' + error.message, 'error');
                });
        }
        
        // Notify Selected Applicants
        function notifySelectedApplicants() {
            const selectedIds = Array.from(document.querySelectorAll('.applicant-checkbox:checked'))
                .map(checkbox => checkbox.getAttribute('data-id'));
            
            if (selectedIds.length === 0) {
                showNotification('Pilih setidak ada pendaftar', 'error');
                return;
            }
            
            const message = notificationMessage.value.trim();
            const subject = emailSubject.value.trim();
            
            if (!message || !subject) {
                showNotification('Masukkan subject dan pesan notifikasi', 'error');
                return;
            }
            
            // Get selected registrations
            const selectedRegistrations = selectedIds.map(id => 
                allRegistrations.find(reg => reg.id === id)
            ).filter(reg => reg !== undefined);
            
            // Send emails
            sendEmailsToApplicants(selectedRegistrations, subject, message);
        }
        
        // Show Applicant Details in Modal
        function showApplicantDetails(registrationId) {
            const registration = allRegistrations.find(reg => reg.id === registrationId);
            
            if (!registration) {
                showNotification('Data pendaftar tidak ditemukan', 'error');
                return;
            }
            
            // Update modal with registration data
            modalName.textContent = registration.nama;
            modalNIM.textContent = registration.nim;
            modalProdi.textContent = registration.prodi;
            modalEmail.textContent = registration.email;
            modalWhatsApp.textContent = registration.noWa;
            modalDivisi1.textContent = registration.firstDivision;
            modalDivisi2.textContent = registration.secondDivision;
            modalAlasan.textContent = registration.alasan || 'Tidak ada alasan';
            modalAlasanDivisi1.textContent = registration.firstDivisionReason || 'Tidak ada alasan';
            modalAlasanDivisi2.textContent = registration.secondDivisionReason || 'Tidak ada alasan';
            
            // Update status badge
            let statusClass = 'status-badge';
            if (registration.status === 'pending') {
                statusClass += ' status-pending';
            } else if (registration.status === 'reviewed') {
                statusClass += ' status-reviewed';
            } else if (registration.status === 'accepted') {
                statusClass += ' status-accepted';
            } else if (registration.status === 'rejected') {
                statusClass += ' status-rejected';
            }
            modalStatus.className = statusClass;
            modalStatus.textContent = registration.status.charAt(0).toUpperCase() + registration.status.slice(1);
            
            // Set avatar with initial
            const initial = registration.nama.charAt(0).toUpperCase();
            modalAvatar.innerHTML = initial;
            modalAvatar.style.background = `linear-gradient(135deg, ${getRandomColor()}, ${getRandomColor()})`;
            
            // Set action buttons
            acceptBtn.setAttribute('data-id', registrationId);
            rejectBtn.setAttribute('data-id', registrationId);
            sendEmailBtn.setAttribute('data-id', registrationId);
            
            // Show/hide action buttons based on status
            if (registration.status === 'pending' || registration.status === 'reviewed') {
                acceptBtn.style.display = 'inline-flex';
                rejectBtn.style.display = 'inline-flex';
            } else {
                acceptBtn.style.display = 'none';
                rejectBtn.style.display = 'none';
            }
            
            // Show modal
            applicantModal.style.display = 'block';
        }
        
        // Update Status
        function updateStatus(registrationId, status) {
            // Update status in Firebase
            database.ref('registrations').child(registrationId).update({ status })
                .then(() => {
                    // Update local data
                    const registration = allRegistrations.find(reg => reg.id === registrationId);
                    if (registration) {
                        registration.status = status;
                    }
                    
                    // Refresh table
                    filterData();
                    
                    // Log activity
                    logActivity(currentUser.email, `Updated status to ${status} for applicant ${registration.nama}`);
                    
                    // Close modal if open
                    if (applicantModal.style.display === 'block') {
                        applicantModal.style.display = 'none';
                    }
                    
                    showNotification(`Status berhasil diperbarui menjadi ${status} untuk ${registration.nama}`, 'success');
                })
                .catch(error => {
                    showNotification('Error updating status: ' + error.message, 'error');
                });
        }
        
        // Send Email to Applicant
        function sendEmailToApplicant(registrationId) {
            const registration = allRegistrations.find(reg => reg.id === registrationId);
            
            if (!registration) {
                showNotification('Data pendaftar tidak ditemukan', 'error');
                return;
            }
            
            const subject = `Informasi Pendaftaran Rana9 - ${registration.nama}`;
            const message = `Berikut adalah data pendaftaran Anda:\n\nNama: ${registration.nama}\nNIM: ${registration.nim}\nProdi: ${registration.prodi}\nEmail: ${registration.email}\nNo. WhatsApp: ${registration.noWa}\nDivisi Pilihan 1: ${registration.firstDivision}\nDivisi Pilihan 2: ${registration.secondDivision}\nAlasan Ikut Open Recruitment: ${registration.alasan || 'Tidak ada alasan'}\nAlasan Memilih Divisi Pertama: ${registration.firstDivisionReason || 'Tidak ada alasan'}\nAlasan Memilih Divisi Kedua: ${registration.secondDivisionReason || 'Tidak ada alasan'}\nStatus: ${registration.status}`;
            
            // Send email
            sendEmailsToApplicants([registration], subject, message);
        }
        
        // Load Division Stats
        function loadDivisionStats() {
            statsLoading.style.display = 'flex';
            statsContainer.style.display = 'none';
            chartContainer.style.display = 'none';
            statsTableContainer.style.display = 'none';
            
            database.ref('registrations').once('value')
                .then(snapshot => {
                    const data = snapshot.val();
                    divisionStats = {};
                    
                    // Initialize division stats
                    const divisions = [
                        'Sekretaris',
                        'Bendahara',
                        'Divisi Pendidikan',
                        'Divisi Kewirausahaan',
                        'Humas (Internal & Eksternal)',
                        'Divisi Perkap',
                        'Divisi Dokumentasi',
                        'Divisi Publikasi'
                    ];
                    
                    divisions.forEach(division => {
                        divisionStats[division] = {
                            firstChoice: 0,
                            secondChoice: 0,
                            total: 0
                        };
                    });
                    
                    // Count choices
                    if (data) {
                        Object.keys(data).forEach(key => {
                            const registration = data[key];
                            
                            if (divisionStats[registration.firstDivision]) {
                                divisionStats[registration.firstDivision].firstChoice++;
                                divisionStats[registration.firstDivision].total++;
                            }
                            
                            if (divisionStats[registration.secondDivision]) {
                                divisionStats[registration.secondDivision].secondChoice++;
                                divisionStats[registration.secondDivision].total++;
                            }
                        });
                    }
                    
                    // Update total registrants
                    totalRegistrants = data ? Object.keys(data).length : 0;
                    
                    // Populate stats
                    populateDivisionStats();
                    
                    // Create chart
                    createDivisionChart();
                    
                    statsLoading.style.display = 'none';
                    statsContainer.style.display = 'grid';
                    chartContainer.style.display = 'block';
                    statsTableContainer.style.display = 'block';
                })
                .catch(error => {
                    showNotification('Error loading stats: ' + error.message, 'error');
                    statsLoading.style.display = 'none';
                });
        }
        
        // Populate Division Stats
        function populateDivisionStats() {
            // Clear container
            statsContainer.innerHTML = '';
            statsTableBody.innerHTML = '';
            
            // Add total registrants card
            const totalCard = document.createElement('div');
            totalCard.className = 'stat-card';
            totalCard.innerHTML = `
                <div class="stat-icon total">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-info">
                    <h3>${totalRegistrants}</h3>
                    <p>Total Pendaftar</p>
                </div>
            `;
            statsContainer.appendChild(totalCard);
            
            // Division icons
            const divisionIcons = {
                'Sekretaris': 'fa-file-alt',
                'Bendahara': 'fa-coins',
                'Divisi Pendidikan': 'fa-graduation-cap',
                'Divisi Kewirausahaan': 'fa-briefcase',
                'Humas (Internal & Eksternal)': 'fa-comments',
                'Divisi Perkap': 'fa-tools',
                'Divisi Dokumentasi': 'fa-camera',
                'Divisi Publikasi': 'fa-bullhorn'
            };
            
            // Create stat cards
            Object.keys(divisionStats).forEach(division => {
                const stats = divisionStats[division];
                const iconClass = divisionIcons[division] || 'fa-users';
                const divisionClass = division.toLowerCase().replace(/\s+/g, '-').replace(/[()]/g, '');
                
                const card = document.createElement('div');
                card.className = 'stat-card';
                card.innerHTML = `
                    <div class="stat-icon ${divisionClass}">
                        <i class="fas ${iconClass}"></i>
                    </div>
                    <div class="stat-info">
                        <h3>${stats.total}</h3>
                        <p>${division}</p>
                    </div>
                `;
                
                statsContainer.appendChild(card);
                
                // Add to table
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${division}</td>
                    <td>${stats.firstChoice}</td>
                    <td>${stats.secondChoice}</td>
                    <td>${stats.total}</td>
                `;
                
                statsTableBody.appendChild(row);
            });
        }

// Create Division Chart
        function createDivisionChart() {
            const ctx = document.getElementById('divisionChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (divisionChart) {
                divisionChart.destroy();
            }
            
            const labels = Object.keys(divisionStats);
            const firstChoiceData = labels.map(division => divisionStats[division].firstChoice);
            const secondChoiceData = labels.map(division => divisionStats[division].secondChoice);
            const totalData = labels.map(division => divisionStats[division].total);
            
            divisionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Pilihan Pertama',
                            data: firstChoiceData,
                            backgroundColor: 'rgba(106, 17, 203, 0.7)',
                            borderColor: 'rgba(106, 17, 203, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Pilihan Kedua',
                            data: secondChoiceData,
                            backgroundColor: 'rgba(37, 211, 102, 0.7)',
                            borderColor: 'rgba(37, 211, 102, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

// Update Preview Table
        function updatePreviewTable() {
            previewTableContainer.innerHTML = '';
            
            if (checkAllData.checked) {
                const previewTitle = document.createElement('h3');
                previewTitle.textContent = 'Preview: Semua Data Pendaftar';
                previewTableContainer.appendChild(previewTitle);
                
                const tableWrapper = document.createElement('div');
                tableWrapper.className = 'table-wrapper';
                
                const table = document.createElement('table');
                table.className = 'data-table';
                
                // Create table header
                const thead = document.createElement('thead');
                thead.innerHTML = `
                    <tr>
                        <th>No</th>
                        <th>Nama</th>
                        <th>NIM</th>
                        <th>Prodi</th>
                        <th>Email</th>
                        <th>No. WhatsApp</th>
                        <th>Divisi Pilihan 1</th>
                        <th>Divisi Pilihan 2</th>
                        <th>Status</th>
                    </tr>
                `;
                table.appendChild(thead);
                
                // Create table body (show only first 5 rows)
                const tbody = document.createElement('tbody');
                allRegistrations.slice(0, 5).forEach((registration, index) => {
                    const row = document.createElement('tr');
                    
                    // Format timestamp
                    const timestamp = new Date(registration.timestamp);
                    const formattedTimestamp = timestamp.toLocaleString('id-ID');
                    
                    // Get status badge class
                    let statusClass = 'status-badge';
                    if (registration.status === 'pending') {
                        statusClass += ' status-pending';
                    } else if (registration.status === 'reviewed') {
                        statusClass += ' status-reviewed';
                    } else if (registration.status === 'accepted') {
                        statusClass += ' status-accepted';
                    } else if (registration.status === 'rejected') {
                        statusClass += ' status-rejected';
                    }
                    
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${registration.nama}</td>
                        <td>${registration.nim}</td>
                        <td>${registration.prodi}</td>
                        <td>${registration.email}</td>
                        <td>${registration.noWa}</td>
                        <td>${registration.firstDivision}</td>
                        <td>${registration.secondDivision}</td>
                        <td><span class="${statusClass}">${registration.status}</span></td>
                    `;
                    
                    tbody.appendChild(row);
                });
                table.appendChild(tbody);
                
                tableWrapper.appendChild(table);
                previewTableContainer.appendChild(tableWrapper);
                
                if (allRegistrations.length > 5) {
                    const moreInfo = document.createElement('p');
                    moreInfo.textContent = `... dan ${allRegistrations.length - 5} data lainnya`;
                    moreInfo.style.textAlign = 'center';
                    moreInfo.style.marginTop = '10px';
                    previewTableContainer.appendChild(moreInfo);
                }
            }
            
            if (checkStats.checked) {
                const previewTitle = document.createElement('h3');
                previewTitle.textContent = 'Preview: Statistik Per Divisi';
                previewTitle.style.marginTop = '20px';
                previewTableContainer.appendChild(previewTitle);
                
                const tableWrapper = document.createElement('div');
                tableWrapper.className = 'table-wrapper';
                
                const table = document.createElement('table');
                table.className = 'data-table';
                
                // Create table header
                const thead = document.createElement('thead');
                thead.innerHTML = `
                    <tr>
                        <th>Divisi</th>
                        <th>Pilihan Pertama</th>
                        <th>Pilihan Kedua</th>
                        <th>Total Peminat</th>
                    </tr>
                `;
                table.appendChild(thead);
                
                // Create table body
                const tbody = document.createElement('tbody');
                Object.keys(divisionStats).forEach(division => {
                    const stats = divisionStats[division];
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${division}</td>
                        <td>${stats.firstChoice}</td>
                        <td>${stats.secondChoice}</td>
                        <td>${stats.total}</td>
                    `;
                    tbody.appendChild(row);
                });
                table.appendChild(tbody);
                
                tableWrapper.appendChild(table);
                previewTableContainer.appendChild(tableWrapper);
            }
        }
        
        // Download Excel
        function downloadExcel() {
            // Create a new workbook
            const wb = XLSX.utils.book_new();
            
            // Process all data
            const ws = XLSX.utils.json_to_sheet(allRegistrations);
            XLSX.utils.book_append_sheet(wb, ws, 'Semua Data Pendaftar');
            
            // Process stats data
            const statsData = Object.keys(divisionStats).map(division => {
                return {
                    Divisi: division,
                    'Pilihan Pertama': divisionStats[division].firstChoice,
                    'Pilihan Kedua': divisionStats[division].secondChoice,
                    'Total Peminat': divisionStats[division].total
                };
            });
            const statsWs = XLSX.utils.json_to_sheet(statsData);
            XLSX.utils.book_append_sheet(wb, statsWs, 'Statistik Per Divisi');
            
            // Generate filename with timestamp
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
            const filename = `Rana9_Recruitment_Data_${timestamp}.xlsx`;
            
            // Save the file
            XLSX.writeFile(wb, filename);
            
            showNotification('File Excel berhasil diunduh', 'success');
        }
        
        // Download PDF
        function downloadPDF() {
            const { jsPDF } = window.jspdf.js;
            
            // Create a new PDF document
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(18);
            doc.text('Laporan Data Pendaftar Rana9', 14, 20);
            
            // Add table
            const tableData = allRegistrations.map((reg, index) => [
                index + 1,
                reg.nama,
                reg.nim,
                reg.prodi,
                reg.email,
                reg.noWa,
                reg.firstDivision,
                reg.secondDivision,
                reg.status || 'Pending'
            ]);
            
            doc.autoTable({
                head: [['No', 'Nama', 'NIM', 'Prodi', 'Email', 'No. WhatsApp', 'Divisi Pilihan 1', 'Divisi Pilihan 2', 'Status']],
                body: tableData
            }, {
                theme: 'grid',
                styles: { fillColor: [220, 220, 220], textColor: 0 },
                headerStyles: { fillColor: [66, 102, 245], textColor: 255 },
                bodyStyles: { fillColor: [245, 245, 245], textColor: 0 },
                alternateRowStyles: { fillColor: [240, 240, 240], textColor: 0 }
            });
            
            // Add stats
            doc.setFontSize(14);
            doc.text('Statistik Per Divisi', 14, 140);
            
            const statsTableData = Object.keys(divisionStats).map(division => {
                return [
                    division,
                    divisionStats[division].firstChoice.toString(),
                    divisionStats[division].secondChoice.toString(),
                    divisionStats[division].total.toString()
                ];
            });
            
            doc.autoTable({
                head: [['Divisi', 'Pilihan Pertama', 'Pilihan Kedua', 'Total']],
                body: statsTableData
            }, {
                theme: 'grid',
                styles: { fillColor: [220, 220, 220], textColor: 0 },
                headerStyles: { fillColor: [66, 102, 245], textColor: 255 },
                bodyStyles: { fillColor: [245, 245, 245], textColor: 0 },
                alternateRowStyles: { fillColor: [240, 240, 240], textColor: 0 }
            });
            
            // Save the PDF
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
            const filename = `Rana9_Recruitment_Data_${timestamp}.pdf`;
            
            doc.save(filename);
            
            showNotification('File PDF berhasil diunduh', 'success');
        }
        
        // Send Bulk Notification
        function sendBulkNotification() {
            const message = notificationMessage.value.trim();
            const subject = emailSubject.value.trim();
            const recipients = notificationRecipients.value;
            
            if (!message || !subject) {
                showNotification('Masukkan subject dan pesan notifikasi', 'error');
                return;
            }
            
            let targetRegistrations = [];
            
            if (recipients === 'all') {
                targetRegistrations = allRegistrations;
            } else if (recipients === 'pending') {
                targetRegistrations = allRegistrations.filter(reg => reg.status === 'pending');
            } else if (recipients === 'accepted') {
                targetRegistrations = allRegistrations.filter(reg => reg.status === 'accepted');
            } else if (recipients === 'rejected') {
                targetRegistrations = allRegistrations.filter(reg => reg.status === 'rejected');
            }
            
            if (targetRegistrations.length === 0) {
                showNotification('Tidak ada pendaftar yang sesuai dengan kriteria', 'info');
                return;
            }
            
            // Send emails
            sendEmailsToApplicants(targetRegistrations, subject, message);
        }
        
        // Send Emails to Applicants
        function sendEmailsToApplicants(applicants, subject, message) {
            // Check if email is configured
            if (!emailConfig.email || !emailConfig.appPassword) {
                showNotification('Email belum dikonfigurasi. Silakan atur di halaman Pengaturan Email.', 'error');
                return;
            }
            
            // Show progress modal
            emailProgress.classList.add('show');
            emailProgressFill.style.width = '0%';
            emailProgressText.textContent = `Memproses 0 dari ${applicants.length} email`;
            
            let sentCount = 0;
            let failedCount = 0;
            
            // Process emails one by one with a delay to avoid rate limiting
            function processNextEmail(index) {
                if (index >= applicants.length) {
                    // All emails processed
                    emailProgress.classList.remove('show');
                    
                    if (failedCount > 0) {
                        showNotification(`Email terkirim: ${sentCount}, Gagal: ${failedCount}`, 'error');
                    } else {
                        showNotification(`Berhasil mengirim ${sentCount} email`, 'success');
                    }
                    
                    // Log activity
                    logActivity(currentUser.email, `Sent notification to ${applicants.length} applicants`);
                    
                    // Clear form
                    notificationMessage.value = '';
                    emailSubject.value = '';
                    
                    return;
                }
                
                const applicant = applicants[index];
                
                // Update progress
                const progress = ((index + 1) / applicants.length) * 100;
                emailProgressFill.style.width = `${progress}%`;
                emailProgressText.textContent = `Memproses ${index + 1} dari ${applicants.length} email`;
                
                // Create HTML email template with applicant data
                const emailBody = createEmailTemplate(applicant, subject, message);
                
                // Send email using SMTP.js
                Email.send({
                    Host: emailConfig.smtpServer,
                    Port: emailConfig.smtpPort,
                    Username: emailConfig.email,
                    Password: emailConfig.appPassword,
                    To: applicant.email,
                    From: emailConfig.email,
                    Subject: subject,
                    Body: emailBody
                })
                .then(function(response) {
                    console.log('Email sent successfully!', response);
                    sentCount++;
                    
                    // Log notification to Firebase
                    logNotification(applicant.id, subject, message, 'success');
                    
                    // Process next email after a short delay
                    setTimeout(() => processNextEmail(index + 1), 1000);
                })
                .catch(function(error) {
                    console.error('Failed to send email:', error);
                    failedCount++;
                    
                    // Log failed notification to Firebase
                    logNotification(applicant.id, subject, message, 'failed');
                    
                    // Process next email after a short delay
                    setTimeout(() => processNextEmail(index + 1), 1000);
                });
            }
            
            // Start processing emails
            processNextEmail(0);
        }
        

        
        // Log Notification to Firebase
        function logNotification(applicantId, subject, message, status) {
            const timestamp = new Date().toISOString();
            
            database.ref('notifications').push({
                applicantId: applicantId,
                subject: subject,
                message: message,
                status: status,
                timestamp: timestamp,
                sentBy: currentUser.email
            });
        }
        
        // Load Activity Log
        function loadActivityLog() {
            logLoading.style.display = 'flex';
            activityLogContainer.style.display = 'none';
            
            database.ref('activityLog').orderByChild('timestamp').limitToLast(50).once('value')
                .then(snapshot => {
                    const logData = snapshot.val();
                    
                    if (logData) {
                        displayActivityLog(logData);
                    }
                    
                    logLoading.style.display = 'none';
                    activityLogContainer.style.display = 'block';
                })
                .catch(error => {
                    showNotification('Error loading activity log: ' + error.message, 'error');
                    logLoading.style.display = 'none';
                });
        }
        
        // Display Activity Log
        function displayActivityLog(logData) {
            activityLogContainer.innerHTML = '';
            
            if (Object.keys(logData).length === 0) {
                const noLogItem = document.createElement('div');
                noLogItem.style.textAlign = 'center';
                noLogItem.style.padding = '20px';
                noLogItem.textContent = 'Belum ada aktivitas yang tercatat';
                activityLogContainer.appendChild(noLogItem);
                return;
            }
            
            Object.keys(logData).forEach(key => {
                const log = logData[key];
                const logItem = document.createElement('div');
                logItem.className = 'activity-item';
                
                const timestamp = new Date(log.timestamp);
                const formattedTime = timestamp.toLocaleString('id-ID');
                
                logItem.innerHTML = `
                    <div class="activity-time">${formattedTime}</div>
                    <div class="activity-content">
                        <span class="activity-user">${log.user}</span>
                        <span class="activity-action">${log.action}</span>
                    </div>
                `;
                
                activityLogContainer.appendChild(logItem);
            });
        }
        
        // Log Activity
        function logActivity(user, action) {
            const timestamp = new Date().toISOString();
            
            database.ref('activityLog').push({
                user: user,
                action: action,
                timestamp: timestamp
            });
        }
        
        // Show Notification
        function showNotification(message, type) {
            notification.textContent = message;
            notification.className = 'notification ' + type;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            auth.onAuthStateChanged(function(user) {
                if (!user) {
                    // Redirect to login page if not logged in
                    window.location.href = 'login.html';
                } else {
                    currentUser = user;
                    // Update admin profile
                    updateAdminProfile(user);
                    // Load admin list
                    loadAdminList();
                    // Load email settings
                    loadEmailSettings();
                    // Load initial data
                    loadAllData();
                    loadDivisionStats();
                    loadActivityLog();
                }
            });
            
            // Show/hide FAB based on screen size
            handleFabDisplay();
            window.addEventListener('resize', handleFabDisplay);
            
            // Close FAB menu when clicking outside
            document.addEventListener('click', function(e) {
                if (fabMenu.classList.contains('show') && !fabBtn.contains(e.target)) {
                    fabMenu.classList.remove('show');
                }
            });
        });
        
        // Handle FAB display based on screen size
        function handleFabDisplay() {
            if (window.innerWidth <= 768) {
                fabContainer.style.display = 'block';
            } else {
                fabContainer.style.display = 'none';
            }
        }
    </script>
</body>
</html>